{"version":3,"file":"Test.13f1c240.1715140736669.js","sources":["../../src/components/guider/Guider.vue","../../src/pages/Test.vue"],"sourcesContent":["<script lang=\"ts\" setup>\n  import { offsetScreen } from '@/utils/htmlHelper';\n  import { GuiderOption, GuideTarget } from './interface';\n  import { PropType, watch, reactive, computed, ref, onMounted, onBeforeUnmount } from 'vue';\n\n  const props = defineProps({\n    current: [HTMLElement, Object, String] as PropType<GuideTarget>,\n    options: {\n      required: true,\n      type: Array<GuiderOption>,\n    },\n    show: Boolean,\n  });\n\n  const index = ref(0);\n\n  const currentIndex = computed({\n    get(): number {\n      if (!props.current) {\n        return index.value;\n      }\n      index.value = props.options.findIndex((item) => item.target === props.current);\n      return index.value;\n    },\n    set(val) {\n      const target = props.options[val];\n      if (target) {\n        index.value = val;\n        emit('update:current', target.target);\n      } else {\n        index.value = 0;\n        emit('close');\n        emit('update:current', props.options[0].target);\n        emit('update:show', false);\n      }\n    },\n  });\n\n  const doc = ref<HTMLElement>();\n\n  const flag = ref(props.show);\n\n  const location = reactive({\n    width: 0,\n    height: 0,\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n  });\n\n  // 事件\n  // defineEmits(['close', 'update:show', 'update:current'])\n  const emit = defineEmits<{\n    (e: 'close'): void;\n    (e: 'update:show', show: boolean): void;\n    (e: 'update:current', target?: GuideTarget): void;\n  }>();\n\n  // 目标 html 元素\n  const targetEl = computed<HTMLElement>(() => {\n    const _el = props.current ?? props.options[index.value]?.target;\n    if (!_el) {\n      return;\n    }\n    if (typeof _el === 'string') {\n      return document.querySelector(_el);\n    } else {\n      // @ts-ignore\n      return _el instanceof HTMLElement ? _el : _el.$el;\n    }\n  });\n\n  // 方位\n  type Direction = 'vertical' | 'horizontal';\n  // 朝向\n  type Site = 'top' | 'right' | 'bottom' | 'left';\n  // 位置\n  type Placement = {\n    main: Direction;\n    sub: Direction;\n    vertical: Site | 'center';\n    horizontal: Site | 'center';\n  };\n\n  // doc 文档显示位置\n  const placement = computed<Placement>(() => {\n    const { offsetWidth: docWidth, offsetHeight: docHeight } = doc.value || {\n      offsetWidth: 0,\n      offsetHeight: 0,\n    };\n    const { left: tLeft, top: tTop, right: tRight, bottom: tBottom, height: tHeight, width: tWidth } = location;\n\n    const p: Placement = {\n      main: 'horizontal',\n      sub: 'vertical',\n      horizontal: 'left',\n      vertical: 'top',\n    };\n\n    // 判断文档位置在主方向为水平还是垂直\n    if (Math.max(tLeft, tRight) >= Math.max(tTop, tBottom)) {\n      p.main = 'horizontal';\n      p.sub = 'vertical';\n      p.horizontal = tLeft > tRight ? 'left' : 'right';\n      if (tTop + tHeight / 2 < docHeight / 2 && tBottom + tHeight / 2 > docHeight / 2) {\n        p.vertical = 'top';\n      } else if (tTop + tHeight / 2 > docHeight / 2 && tBottom + tHeight / 2 < docHeight / 2) {\n        p.vertical = 'bottom';\n      } else {\n        p.vertical = 'center';\n      }\n    } else {\n      p.main = 'vertical';\n      p.sub = 'horizontal';\n      p.vertical = tTop > tBottom ? 'top' : 'bottom';\n      if (tLeft + tWidth / 2 < docWidth / 2 && tRight + tWidth / 2 > docWidth / 2) {\n        p.horizontal = 'left';\n      } else if (tLeft + tWidth / 2 > docWidth / 2 && tRight + tWidth / 2 < docWidth / 2) {\n        p.horizontal = 'right';\n      } else {\n        p.horizontal = 'center';\n      }\n    }\n    return p;\n  });\n\n  type Position = {\n    top?: number;\n    right?: number;\n    bottom?: number;\n    left?: number;\n  };\n\n  // 指引文档位置\n  const docPosition = computed(() => {\n    const p: Position = { left: 0, top: 0 };\n    if (!props.show || !doc.value || !flag.value) {\n      return p;\n    }\n\n    const { top, left, right, bottom, height, width } = location;\n\n    const place = placement.value;\n    const main = place[place.main] as Site;\n    const sub = place[place.sub];\n\n    const margin = 10;\n    const offset = (place.main === 'horizontal' ? doc.value?.offsetWidth : doc.value?.offsetHeight) ?? 0;\n    p[main] = location[main] - offset - margin;\n\n    if (main === 'right') {\n      p.left = left + width + margin;\n    } else if (main === 'bottom') {\n      p.top = top + height + margin;\n    }\n\n    if (sub === 'center') {\n      if (place.main === 'horizontal') {\n        p.top = top + height / 2 - (doc.value?.offsetHeight ?? 0) / 2;\n      } else {\n        p.left = left + width / 2 - (doc.value?.offsetWidth ?? 0) / 2;\n      }\n    } else {\n      p[sub] = location[sub];\n    }\n\n    if (p.left === undefined) {\n      p.left = window.innerWidth - p.right! - doc.value?.offsetWidth!;\n    }\n\n    if (p.top === undefined) {\n      p.top = window.innerHeight - p.bottom! - doc.value?.offsetHeight!;\n    }\n\n    return p;\n  });\n\n  // 指示箭头位置\n  const arrowStyle = computed(() => {\n    const p: Position = { left: -16, top: -16 };\n\n    if (!props.show || !doc.value || !flag.value) {\n      return p;\n    }\n\n    const place = placement.value;\n    const main = place[place.main] as Site;\n    const sub = place[place.sub];\n\n    const { offsetHeight = 0, offsetWidth = 0 } = doc.value ?? {};\n\n    if (main === 'left') {\n      p.left = (offsetWidth ?? 0) - 4;\n    } else if (main === 'top') {\n      p.top = (offsetHeight ?? 0) - 4;\n    }\n\n    if (place.main === 'horizontal') {\n      if (sub === 'center') {\n        p.top = offsetHeight / 2 - 10;\n      } else if (sub === 'bottom') {\n        p.top = offsetHeight - location.height / 2 - 10;\n      } else {\n        p.top = location.height / 2 - 10;\n      }\n    }\n\n    if (place.main === 'vertical') {\n      if (sub === 'center') {\n        p.left = offsetWidth / 2 - 10;\n      } else if (sub === 'right') {\n        p.left = offsetWidth - location.width / 2 - 10;\n      } else {\n        p.left = location.width / 2 - 10;\n      }\n    }\n    return p;\n  });\n\n  /**\n   * 设置目标元素位置\n   */\n  function setPosition() {\n    const el = targetEl.value;\n    if (!el) {\n      return;\n    }\n    const p = offsetScreen(el);\n    location.left = p[0];\n    location.top = p[1];\n    location.width = el.offsetWidth;\n    location.height = el.offsetHeight;\n    location.right = window.innerWidth - location.width - location.left;\n    location.bottom = window.innerHeight - location.height - location.top;\n  }\n\n  watch(() => [targetEl.value, props.show], setPosition);\n\n  watch(\n    () => props.show,\n    (val) => {\n      flag.value = val;\n    },\n    {\n      flush: 'post',\n    }\n  );\n\n  onMounted(() => {\n    window.addEventListener('resize', setPosition);\n  });\n\n  onBeforeUnmount(() => {\n    window.removeEventListener('resize', setPosition);\n  });\n\n  function nextStep() {\n    currentIndex.value += 1;\n  }\n\n  function onClose() {\n    emit('close');\n    emit('update:show', false);\n  }\n</script>\n\n<template>\n  <Teleport to=\"body\">\n    <div class=\"guider\" :style=\"`display: ${show ? 'static' : 'none'}`\">\n      <div class=\"guider-left\" :style=\"`border-left: ${location.left - 2}px solid rgba(0, 0, 0, 0.25);`\"></div>\n      <div\n        class=\"guider-top\"\n        :style=\"`left: ${location.left - 2}px; width: ${location.width + 4}px; border-top: ${\n          location.top - 2\n        }px solid rgba(0, 0, 0, 0.25);`\"\n      ></div>\n      <div\n        class=\"guider-right\"\n        :style=\"`left: ${location.left + location.width + 2}px; background-color: rgba(0, 0, 0, 0.25)`\"\n      ></div>\n      <div\n        class=\"guider-bottom\"\n        :style=\"`left: ${location.left - 2}px; width: ${location.width + 4}px; top: ${\n          location.top + location.height + 2\n        }px`\"\n      ></div>\n      <div\n        ref=\"doc\"\n        class=\"guider-doc flex flex-col justify-between rounded-md\"\n        :style=\"`left: ${docPosition.left}px;top:${docPosition.top}px`\"\n      >\n        <div\n          class=\"arrow\"\n          :style=\"`left: ${arrowStyle.left}px; top: ${arrowStyle.top}px; border-${\n            placement[placement.main]\n          }-color: white`\"\n        ></div>\n        <div class=\"guider-content\">\n          <h1>第一步</h1>\n          <div>\n            <slot></slot>\n          </div>\n        </div>\n        <div class=\"guider-footer flex justify-between w-full\">\n          <a-button @click=\"onClose\">关闭</a-button>\n          <a-button type=\"primary\" @click=\"nextStep\">下一步</a-button>\n        </div>\n      </div>\n    </div>\n  </Teleport>\n</template>\n\n<style scoped lang=\"less\">\n  .guider-left {\n    position: fixed;\n    left: 0px;\n    top: 0px;\n    height: 100vh;\n    z-index: 99;\n  }\n\n  .guider-top {\n    position: fixed;\n    z-index: 99;\n    top: 0;\n  }\n\n  .guider-right {\n    top: 0;\n    right: 0;\n    position: fixed;\n    z-index: 99;\n    height: 100vh;\n  }\n\n  .guider-bottom {\n    position: fixed;\n    background-color: rgba(0, 0, 0, 0.25);\n    bottom: 0;\n    z-index: 99;\n  }\n\n  .guider-doc {\n    transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.125);\n    width: 20%;\n    height: 200px;\n    background-color: white;\n    position: fixed;\n    z-index: 100;\n    box-shadow: 0px 4px 20px 0px rgba(0, 0, 0, 0.5);\n    padding: 6px 8px;\n\n    .arrow {\n      transition: all 0.25s ease-in;\n      border-width: 10px;\n      z-index: 9;\n      border-style: solid;\n      position: absolute;\n      border-color: transparent;\n    }\n\n    .guider-footer {\n    }\n  }\n</style>\n","<template>\n  <div class=\"test-page\">\n    <div>\n      <a-button v-auth=\"`personal:edit`\" @click=\"showGuid = true\">新手引导1</a-button>\n      <a-button class=\"btn1\" ref=\"btn1\" type=\"primary\" @click=\"target = btn2\">button 1</a-button>\n      <a-button class=\"btn2\" ref=\"btn2\" type=\"primary\" @click=\"target = btn1\">button 2</a-button>\n      <span v-auth=\"`hello`\" @click=\"onClick\" class=\"ml-40 p-2\">test</span>\n    </div>\n    <Guider :current=\"target\" :options=\"options\" v-model:show=\"showGuid\">\n      <div ref=\"doc\" @click=\"sayHello\">功能指引</div>\n    </Guider>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\n  import { ComponentPublicInstance, onMounted, reactive, ref } from 'vue';\n  import Guider, { GuiderOption } from '@/components/guider';\n  import { useAuthStore } from '@/plugins';\n\n  const authStore = useAuthStore();\n  authStore.setAuthorities(['personal:edit', 'personal:remove']);\n  const sayHi = authStore.useAuth('personal:edit', (name: string) => console.log('hi, ' + name));\n\n  const onClick = () => console.log('say hi');\n\n  sayHi('jack');\n\n  const btn1 = ref<ComponentPublicInstance>();\n  const btn2 = ref<ComponentPublicInstance>();\n  const doc = ref<HTMLElement>();\n\n  let options: GuiderOption[] = [];\n\n  const target = ref<ComponentPublicInstance | HTMLElement>();\n\n  const showGuid = ref(false);\n\n  function sayHello() {\n    console.log('hello');\n  }\n\n  onMounted(() => {\n    target.value = btn1.value;\n    options.push(\n      {\n        target: btn1.value,\n        doc: doc.value,\n      },\n      {\n        target: btn2.value,\n        doc: doc.value,\n      }\n    );\n  });\n</script>\n\n<style lang=\"less\" scoped>\n  .test-page {\n    height: calc(100vh);\n    padding: 24px;\n    position: relative;\n\n    .ant-btn {\n      position: absolute;\n    }\n\n    .btn1 {\n      left: 0px;\n      top: 92px;\n    }\n\n    .btn2 {\n      top: 92px;\n      right: 0;\n    }\n\n    .btn3 {\n      bottom: 0;\n      right: 0;\n    }\n\n    .btn4 {\n      bottom: 0;\n      left: 0px;\n    }\n\n    .btn5 {\n      left: calc(50% - 85px);\n      top: calc(50% - 32px);\n    }\n\n    .btn6 {\n      left: calc(50%);\n      top: calc(50% - 32px);\n    }\n\n    .btn7 {\n      left: calc(50% - 85px);\n      top: calc(50%);\n    }\n\n    .btn8 {\n      left: calc(50%);\n      top: calc(50%);\n    }\n  }\n</style>\n"],"names":["props","__props","index","ref","currentIndex","computed","item","val","target","emit","doc","flag","location","reactive","__emit","targetEl","_el","_a","placement","docWidth","docHeight","tLeft","tTop","tRight","tBottom","tHeight","tWidth","p","docPosition","top","left","right","bottom","height","width","place","main","sub","margin","offset","_b","_c","_d","_e","_f","arrowStyle","offsetHeight","offsetWidth","setPosition","el","offsetScreen","watch","onMounted","onBeforeUnmount","nextStep","onClose","authStore","useAuthStore","sayHi","name","onClick","btn1","btn2","options","showGuid","sayHello"],"mappings":"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"}